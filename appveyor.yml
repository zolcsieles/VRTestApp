version: build.{build}

skip-tags: true

os: Visual Studio 2013

clone_folder: c:\!BuildOSVR\VRTestApp

platform:
 - Win32
# - x64

configuration:
# - Debug
 - Release

#matrix:
# allow_failured:
#  - platform: x64
#    configuration: Debug

install:
 - cmake --version
 - git submodule update --init --recursive -q

before_build:
 - echo "Starting build..."

build:
  project: VRTestApp.sln
  verbosity: normal
# verbosity: quiet|minimal|normal|detailed

after_build:
 - cmd: mkdir deploy
 - cmd: xcopy .\Working\SDL2.dll .\deploy\
 - cmd: xcopy .\Working\openvr_api.dll .\deploy\
 - cmd: xcopy .\Working\Data .\deploy\ /i /e
 - cmd: xcopy .\%CONFIGURATION%\VRTestApp.exe .\deploy\
 - cmd: 7z a binary.zip %APPVEYOR_BUILD_FOLDER%\deploy\

artifacts:
 - path: binary.zip

deploy:
- provider: GitHub
  tag: vrtestapp-$(appveyor_build_version)-$(platform)
  release: vrtestapp-$(appveyor_build_version)-$(platform)
  description: VR Test App release
  auth_token:
    secure: a1D+fCbSKHqq30FF/sF1hGvs+WHLMrZ2JFKkYS4SdjOOdyve83el5ejZrv5cSYDh
  artifact: binary.zip
  draft: false
  prerelease: true
